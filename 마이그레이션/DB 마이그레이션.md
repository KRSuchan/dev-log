# DB 마이그레이션

기존 데이터베이스의 구조나 데이터를 새로운 환경으로 이전하는 작업

### **1. DB 마이그레이션의 주요 유형**

| 유형 | 설명 | 예시 |
| --- | --- | --- |
| 스키마 마이그레이션 </br> (Scheme Migration) | DB 구조(테이블, 칼럼, 인덱스 등)가 변경되는 경우 | 칼럼 추가, 자료형 변경, 테이블 분리 등 |
| 데이터 마이그레이션 </br> (Data Migration) | 실제 데이터를 옮기거나 변환 | 기존 DB 데이터를 새 DB로 옮김, 포멧 변경 |
|플랫폼 마이그레이션 </br> (Platform Migration)|DBMS 자체를 변경|MySQL → PostgreSQL </br> Oracle → MariaDB|
|버전 마이그레이션 </br> (Version Migration)|동일 DBMS의 버전 업그레이드|MySQL 5.7 → 8.0|
|클라우드 마이그레이션 </br> (Cloud Migration)|온프레미스 DB를 클라우드로 옮김|자체 서버 → AWS RDS, Azure DB|

### **2. 마이그레이션 방식**

|방식|설명|예시|
|--|--|--|
|Big Bang (일괄 이전)|한 시점에 전체 DB를 옮김(서비스 중단 발생)|빠름,단순|다운타임이 큼, 위험도 높음|
|Incremental (점진적 이전)|데이터 일부씩 나누어 옮김|다운타임 감소|동기화 관리 복잡|
|Dual Write (이중 기록)|마이그레이션 기간 동안 두 DB에 동시에 기록|실시간 이전 가능|복잡한 트랜잭션 관리 필요|
|Change Data Capture (CDC)|변경된 데이터만 실시간으로 감지해 전송|무중단 마이그레이션 가능|CDC 설정 복잡, 로그 관리 필요|
|Shadow / Blue-Green 방식|새로운 DB를 미리 구축하고 실제 트래픽 일부를 테스트 후 전환|안정성 높음|비용 증가, 세밀한 테스트 필요|

### **3. 마이그레이션 절차 (일반적인 단계)**

1. 사전 분석
- 현재 DB 구조, 데이터 양, 의존성, 트랜잭션 패턴 분석
- 예 : 외래키, 트리거, 뷰 등 확인
2. 계획 수립
- 마이그레이션 방식 결정
- 다운타임, 백업, 롤백 시나리오 설계
3. 스키마 변환
- 새로운 DB 구조 설계 및 생성
- 필요 시 자동 변환 도구 사용 (ex: AWS SCT, pgloader)
4. 데이터 변환 및 로딩
- ETL(Extract-Transform-Load) 도구나 스크립트로 이전
- 대량 데이터라면 배치나 CDC 활용
5. 검증
- 데이터 무결성, 개수, 정확성 확인
- 애플리케이션과의 호환성 테스트
6. 모니터링 및 롤백 대비
- 성능, 오류 로그 모니터링
- 문제 발생 시 롤백 플랜 실행

### **4. 자주 사용하는 도구들**

|목적|도구 예시|
|--|--|
|스키마/데이터 변환|pgloader, AWS DMS, Ora2Pg, Flyway, Liquibase|
|버전/배포 자동화|Liquibase, Flyway, Alembic|
|실시간 CDC|Debezium, AWS DMS CDC, Kafka Connect|

### **5. 팁**

- 스테이징 환경에서 리허설 필수
- 백업 + 롤백 계획 마련
- 시간 기반 전략(야간, 주말) 전환
- 데이터 검증 스크립트 작성 (count, checksum 등)
- 서비스 중단 없는 방법의 경우 CDC / Dual-write 고려