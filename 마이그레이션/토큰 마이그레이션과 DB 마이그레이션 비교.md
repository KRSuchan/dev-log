# 토큰 마이그레이션과 DB 마이그레이션 비교


### **1. 비교**

| 구분             | **토큰 마이그레이션**                          | **DB 마이그레이션**                                                                        |
| -------------- | -------------------------------------- | ------------------------------------------------------------------------------------ |
| **목적**         | 인증 상태 유지 / 보안 연속성 확보                   | 전체 데이터(회원, 로그, 주문 등) 이관                                                              |
| **대상**         | JWT, Refresh Token, Session Key 등      | 테이블 전체 또는 일부 레코드                                                                     |
| **핵심 위험요소**    | 보안, 키 누출, 만료 정책                        | 데이터 유실, 무결성(Integrity), 성능                                                           |
| **이전 단위**      | 토큰 문자열 / 암호화 키                         | 스키마 + 데이터(컬럼, 인덱스 포함)                                                                |
| **마이그레이션 방식**  |  Secret Key 복제<br> 기존 토큰 검증 호환 유지  |  Dump/Restore<br> ETL(Extract-Transform-Load)<br> 실시간 동기화(Change Data Capture) |
| **테스트 포인트**    | 기존 토큰으로 새 시스템 로그인 되는가                  | 쿼리 결과/레코드 수/트랜잭션 정상 여부                                                               |
| **롤백 전략**      | 이전 Secret Key 재적용                      | 원본 DB로 트래픽 되돌리기                                                                      |
| **다운타임 허용 여부** | 거의 불가 (로그인 유지 필수)                      | 상황에 따라 있음 (배치 이관 가능)                                                                 |
| **대표적 시나리오**   | 인증 서버 교체, Secret 교체, OAuth 서버 이전       | DB 엔진 변경, 클라우드 이관, 스키마 리팩토링                                                          |
| **도구/기술**      | 직접 코드 수정, Secret Manager, JWT 검증 로직 병행 | DB dump, Flyway, Liquibase, DMS(AWS Database Migration Service)                      |

### **2. 핵심**

| 포인트                                   | 설명                                                                                    |
| ------------------------------------- | ------------------------------------------------------------------------------------- |
| **토큰은 “유효성 보장”이 핵심**              | 토큰은 "로그인 세션이 깨지지 않도록" </br> DB는 데이터 정확성이 핵심 |
| **DB는 “정적 데이터”, 토큰은 “동적/만료 데이터”** | 토큰은 계속해서 발급·만료되기 때문에 실시간 전환이 필요|
| **마이그레이션 이후 검증 방식이 다름**           |  JWT는 서명키 기반 검증으로만 확인 가능 </br> DB는 `SELECT COUNT(*)`로 검증 가능|
| **병행 운영 구조가 다름**                  | 토큰은 old/new secret 병행 검증(dual key)으로 전환 </br> DB는 old/new DB 간 read replica나 CDC로 전환|

### **3. 결론**

- DB 마이그레이션: 데이터 정합성과 무중단 전환이 핵심
- 토큰 마이그레이션: 인증 연속성과 보안(서명키 관리)이 핵심

